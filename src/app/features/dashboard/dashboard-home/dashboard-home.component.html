<div class="dashboard-container">
    <!-- Header -->
    <header class="dashboard-header">
        <div class="header-content">
            <div class="greeting-section">
                <h1 class="greeting">{{ greeting }}, {{ userName }}! üëã</h1>
                <div class="user-intelligence-badges d-flex gap-2 mt-1">
                    <span class="badge intelligence-badge" [ngClass]="{
                        'bg-success': userSecurityLevel() === 'safe',
                        'bg-warning text-dark': userSecurityLevel() === 'caution',
                        'bg-danger': userSecurityLevel() === 'high_risk'
                    }">
                        üõ°Ô∏è {{ userClassification() }}
                    </span>
                    <span class="badge classification-badge bg-info">
                        üìç {{ zoneClassification() }}
                    </span>
                </div>
                <p class="subtitle mt-2">Where you dey go today? üá≥üá¨</p>
            </div>

            <!-- <div class="header-actions">
                <button class="profile-btn" (click)="navigateToProfile()">
                    <div class="profile-avatar" *ngIf="userAvatar">
                        <img [src]="userAvatar" [alt]="userName">
                    </div>
                    <div class="profile-avatar-placeholder" *ngIf="!userAvatar">
                        {{ getUserInitials() }}
                    </div>
                    <div class="profile-info">
                        <span class="profile-name">{{ userFullName }}</span>
                        <span class="profile-email">{{ userEmail }}</span>
                    </div>
                </button>
            </div> -->
            <button class="notification-btn" (click)="toggleNotifications()">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9" />
                    <path d="M10.3 21a1.94 1.94 0 0 0 3.4 0" />
                </svg>
                @if ((unreadCount$ | async); as count) {
                <span class="notification-badge">{{ count }}</span>
                }
            </button>
        </div>

        <app-notification-center [isOpen]="isNotificationCenterOpen" (close)="isNotificationCenterOpen = false" />

        <!-- Search Bar -->
        <div class="search-container">
            <div class="search-box">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                    class="search-icon">
                    <circle cx="11" cy="11" r="8" />
                    <path d="m21 21-4.3-4.3" />
                </svg>
                <input type="text" [(ngModel)]="searchQuery" (input)="onSearchInput()" (keyup.enter)="onSearch()"
                    placeholder="Search routes, bus stops, events..." class="search-input">
                <button class="voice-btn" title="Voice search">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z" />
                        <path d="M19 10v2a7 7 0 0 1-14 0v-2" />
                        <line x1="12" x2="12" y1="19" y2="22" />
                    </svg>
                </button>
            </div>

            <!-- Search Results Dropdown -->
            @if (searchResults.length > 0) {
            <div class="search-dropdown">
                @for (result of searchResults; track result.id) {
                <div class="search-result-item" (click)="selectResult(result)">
                    <div class="result-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z" />
                            <circle cx="12" cy="10" r="3" />
                        </svg>
                    </div>
                    <div class="result-info">
                        <div class="result-name">{{ result.name }}</div>
                        <div class="result-location">{{ result.address || result.city }}</div>
                    </div>
                </div>
                }
            </div>
            }
        </div>
    </header>

    <!-- Main Content -->
    <main class="dashboard-main">
        <!-- Quick Actions -->
        <section class="quick-actions">
            <button class="action-card action-primary" routerLink="/home">
                <div class="action-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
                        <polyline points="9 22 9 12 15 12 15 22" />
                    </svg>
                </div>
                <div class="action-text">
                    <div class="action-title">Plan Trip</div>
                    <div class="action-subtitle">Where you dey go?</div>
                </div>
            </button>



            <button class="action-card action-tertiary" routerLink="/profile">
                <div class="action-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path
                            d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z" />
                    </svg>
                </div>
                <div class="action-text">
                    <div class="action-title">Saved</div>
                    <div class="action-subtitle">Favorite routes</div>
                </div>
            </button>

            <button class="action-card action-quaternary" routerLink="/bus-stops/add">
                <div class="action-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M12 5v14M5 12h14" />
                    </svg>
                </div>
                <div class="action-text">
                    <div class="action-title">Contribute</div>
                    <div class="action-subtitle">Add places</div>
                </div>
            </button>

            @if (authService.isAdmin()) {
            <button class="action-card action-quinary" routerLink="/bus-stops/verify-portal">
                <div class="action-icon">
                    <i class="fas fa-certificate"></i>
                </div>
                <div class="action-text">
                    <div class="action-title">Verify</div>
                    <div class="action-subtitle">Earn points</div>
                </div>
            </button>
            }
        </section>

        <!-- Tabs -->
        <section class="content-tabs">
            <div class="tab-buttons">
                <button [class.active]="activeTab === 'routes'" (click)="setActiveTab('routes')" class="tab-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M8 6v6" />
                        <path d="M15 6v6" />
                        <path d="M2 12h19.6" />
                    </svg>
                    Routes
                </button>
                <button [class.active]="activeTab === 'events'" (click)="setActiveTab('events')" class="tab-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect width="18" height="18" x="3" y="4" rx="2" ry="2" />
                        <line x1="16" x2="16" y1="2" y2="6" />
                        <line x1="8" x2="8" y1="2" y2="6" />
                        <line x1="3" x2="21" y1="10" y2="10" />
                    </svg>
                    Events
                </button>
                <button [class.active]="activeTab === 'rides'" (click)="setActiveTab('rides')" class="tab-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path
                            d="M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2" />
                        <circle cx="7" cy="17" r="2" />
                        <path d="M9 17h6" />
                        <circle cx="17" cy="17" r="2" />
                    </svg>
                    Tag-Along
                </button>
            </div>
        </section>

        <!-- Nearby Bus Stops -->
        @if (activeTab === 'routes') {
        <section class="nearby-stops">
            <div class="section-header">
                <div class="title-with-fallback">
                    <h2 class="section-title">Nearby Bus Stops</h2>
                    @if (isCityCenterFallback) {
                    <span class="fallback-indicator">üìç Showing Major Abuja Terminals</span>
                    } @else if (currentUserLocation) {
                    <span class="location-ready-indicator">‚úÖ Using your current location</span>
                    } @else {
                    <span class="finding-location-indicator">üîç Finding your location...</span>
                    }
                </div>
                <button class="see-all-btn" (click)="navigateToBusStops()">See all</button>
            </div>

            <div class="stops-grid">
                @for (stop of nearbyStops; track stop.id) {
                <div class="stop-card" (click)="planRouteToStop(stop)">
                    <div class="stop-header">
                        <div class="stop-info">
                            <h3 class="stop-name">{{ stop.name }}</h3>
                            <p class="stop-distance">üìç {{ stop.distance }}</p>
                        </div>
                        <div class="stop-badges">
                            @if (stop.source === 'external_map_cached') {
                            <span class="source-badge map-verified">Map Verified</span>
                            } @else if (stop.source === 'major_hubs_fallback') {
                            <span class="source-badge major-hub">Major Hub</span>
                            }
                            <div class="stop-status" [style.background]="getStatusColor(stop.status)">
                                {{ getStatusLabel(stop.status) }}
                            </div>
                            <span *ngIf="stop.zone" class="badge classification-badge bg-info ms-2"
                                style="font-size: 0.7rem;">
                                {{ stop.zone }}
                            </span>
                        </div>
                    </div>
                    <div class="stop-routes">
                        @for (route of stop.routes; track route) {
                        <span class="route-badge">{{ route }}</span>
                        }
                    </div>
                    <div class="stop-footer">
                        <div class="next-bus">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10" />
                                <polyline points="12 6 12 12 16 14" />
                            </svg>
                            Next Busstop: <strong>{{ stop.travelTime }}</strong>
                        </div>
                    </div>
                </div>
                }
            </div>
        </section>
        }

        <!-- Popular Routes -->
        @if (activeTab === 'routes') {
        <section class="popular-routes">
            <div class="section-header">
                <h2 class="section-title">Popular Routes</h2>
                <button class="see-all-btn">See all</button>
            </div>

            <div class="routes-grid">
                @for (route of popularRoutes; track route.id) {
                <div class="route-card" (click)="viewRoute(route)">
                    <div class="route-badge-container">
                        @if (route.trending) {
                        <span class="trending-badge">üî• Trending</span>
                        }
                    </div>
                    <h3 class="route-name">{{ route.name }}</h3>
                    <div class="route-details">
                        <div class="route-detail">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10" />
                                <polyline points="12 6 12 12 16 14" />
                            </svg>
                            {{ route.duration }}
                        </div>
                        <div class="route-detail">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <line x1="12" y1="1" x2="12" y2="23" />
                                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" />
                            </svg>
                            {{ route.fare }}
                        </div>
                    </div>
                    <div class="route-footer">
                        <span class="buses-count">{{ route.buses }} buses available</span>
                    </div>
                </div>
                }
            </div>
        </section>
        }

        <!-- Upcoming Events -->
        @if (activeTab === 'events') {
        <section class="upcoming-events">
            <div class="section-header">
                <h2 class="section-title">Happening in Abuja</h2>
                <button class="see-all-btn">See all</button>
            </div>

            <div class="events-list">
                @for (event of upcomingEvents; track event.id) {
                <div class="event-card" (click)="viewEvent(event)">
                    <div class="event-image">{{ event.image }}</div>
                    <div class="event-content">
                        <div class="event-category">{{ event.category }}</div>
                        <h3 class="event-title">{{ event.title }}</h3>
                        <div class="event-meta">
                            <div class="event-datetime">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <rect width="18" height="18" x="3" y="4" rx="2" ry="2" />
                                    <line x1="16" x2="16" y1="2" y2="6" />
                                    <line x1="8" x2="8" y1="2" y2="6" />
                                    <line x1="3" x2="21" y1="10" y2="10" />
                                </svg>
                                {{ event.date }} at {{ event.time }}
                            </div>
                            <div class="event-location">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z" />
                                    <circle cx="12" cy="10" r="3" />
                                </svg>
                                {{ event.location }}
                            </div>
                        </div>
                        <div class="event-footer">
                            <span class="attending-count">{{ event.attending }} attending</span>
                            <button class="interested-btn">Interested</button>
                        </div>
                    </div>
                </div>
                }
            </div>
        </section>
        }

        <!-- Tag-Along Rides -->
        @if (activeTab === 'rides') {
        <section class="tagalong-rides">
            <div class="section-header">
                <h2 class="section-title">Available Rides</h2>
                <button class="see-all-btn">See all</button>
            </div>

            <div class="rides-list">
                @for (ride of tagAlongRides; track ride.id) {
                <div class="ride-card">
                    <div class="ride-header">
                        <div class="driver-info">
                            <img [src]="ride.avatar" [alt]="ride.driver" class="driver-avatar">
                            <div>
                                <div class="driver-name">{{ ride.driver }}</div>
                                <div class="driver-rating">
                                    ‚≠ê {{ ride.rating }}
                                </div>
                            </div>
                        </div>
                        <div class="ride-price">{{ ride.price }}</div>
                    </div>
                    <div class="ride-route">
                        <div class="ride-location">
                            <div class="location-dot from"></div>
                            <div class="location-text">
                                <div class="location-label">From</div>
                                <div class="location-name">{{ ride.from }}</div>
                            </div>
                        </div>
                        <div class="route-line"></div>
                        <div class="ride-location">
                            <div class="location-dot to"></div>
                            <div class="location-text">
                                <div class="location-label">To</div>
                                <div class="location-name">{{ ride.to }}</div>
                            </div>
                        </div>
                    </div>
                    <div class="ride-footer">
                        <div class="ride-info">
                            <span>üïê {{ ride.departureTime }}</span>
                            <span>üí∫ {{ ride.seats }} seats left</span>
                        </div>
                        <button (click)="bookRide(ride)" class="book-btn">Book Now</button>
                    </div>
                </div>
                }
            </div>
        </section>
        }
    </main>

    <!-- Floating Action Button -->
    <button class="fab" routerLink="/bus-stops/add">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="12" y1="5" x2="12" y2="19" />
            <line x1="5" y1="12" x2="19" y2="12" />
        </svg>
    </button>


</div>