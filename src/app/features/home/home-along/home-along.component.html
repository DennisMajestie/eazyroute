<div class="home-along-container">
    <!-- Header -->
    <div class="home-header">
        <div class="logo-section">
            <h1 class="app-title">üåç EazyRoute <span class="along-badge">ALONG</span></h1>
            <p class="tagline">"Where you dey go?"</p>
        </div>

        <!-- Area Context (ALONG Framework) -->
        <div class="area-context" *ngIf="selectedArea">
            <div class="area-info">
                <span class="area-icon">üìç</span>
                <div class="area-details">
                    <span class="area-name">{{ selectedArea.name }}</span>
                    <span class="area-location">{{ selectedArea.territory }}</span>
                </div>
            </div>
            <button class="change-location-btn" (click)="changeLocation()" type="button">
                Change Location
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">

        <!-- Smart Boarding Card -->
        <div class="smart-boarding-card" *ngIf="showSmartBoarding" (click)="findRoute()">
            <div class="boarding-header">
                <span class="boarding-icon">üß†</span>
                <span class="boarding-title">Smart Boarding</span>
            </div>
            <p class="boarding-message">{{ smartBoardingMessage }}</p>
            <div class="boarding-action">
                <span>View Options</span>
                <span class="arrow">‚Üí</span>
            </div>
        </div>

        <!-- Night Mode Alert -->
        <div class="alert alert-night mt-2 mb-3" *ngIf="isNightMode">
            <i class="fas fa-moon me-2"></i>
            <strong>Night Mode:</strong> Prioritizing well-lit arteries.
        </div>

        <!-- FROM Field -->
        <div class="location-field">
            <label class="field-label">üìç FROM <span class="default-badge" *ngIf="isDefaultSelected">üè† Saved
                    Default</span></label>
            <div class="input-wrapper">
                <input type="text" class="location-input" [(ngModel)]="fromInput"
                    (input)="onSearchInput('from', fromInput)" placeholder="Your Location"
                    [class.has-value]="fromInput" />
                <button *ngIf="!fromInput && !isDetectingLocation" class="detect-btn" (click)="detectLocation()"
                    type="button">
                    üéØ Use My Location
                </button>
                <button *ngIf="fromInput" class="clear-btn" (click)="clearField('from')" type="button">
                    √ó
                </button>
                <button *ngIf="fromLocation && fromInput && !isDetectingLocation" class="refine-btn"
                    (click)="refineLocation()" type="button" title="Refine Location Name">
                    ‚úèÔ∏è
                </button>
                <div class="loading-spinner" *ngIf="isDetectingLocation">
                    <div class="spinner"></div>
                </div>
            </div>
            <p class="field-hint" *ngIf="!fromInput">e.g., "Efab Estate", "Lokogoma"</p>
        </div>

        <!-- TO Field -->
        <div class="location-field">
            <label class="field-label">üìç TO</label>
            <div class="input-wrapper">
                <input type="text" class="location-input" [(ngModel)]="toInput" (input)="onSearchInput('to', toInput)"
                    placeholder="Search landmark" [class.has-value]="toInput" />
                <button *ngIf="toInput" class="clear-btn" (click)="clearField('to')" type="button">
                    √ó
                </button>
            </div>
            <p class="field-hint" *ngIf="!toInput">e.g., "Berger", "Wuse", "After Shoprite"</p>
        </div>

        <!-- Search Results -->
        <div class="search-results" *ngIf="showSearchResults && activeField">

            <!-- Loading State with Skeleton -->
            <div *ngIf="loadingState.isLoading()">
                <app-loading-progress [progress]="(loadingState.state$ | async)?.progress || 0"
                    [message]="(loadingState.state$ | async)?.message || COPY.LOADING.SEARCHING">
                </app-loading-progress>
                <app-skeleton-landmark [count]="3" animation="wave"></app-skeleton-landmark>
            </div>

            <!-- Success State - Results -->
            <div *ngIf="!loadingState.isLoading() && searchResults.length > 0" class="results-list">
                <div *ngFor="let result of searchResults" class="result-item"
                    (click)="selectLocation(activeField, result)">
                    <div class="result-icon">{{ getTypeIcon(result.type) }}</div>
                    <div class="result-info">
                        <div class="result-name">{{ result.name }}</div>
                        <div class="result-hierarchy" *ngIf="result.hierarchy">
                            {{ result.hierarchy }}
                        </div>
                        <div class="result-type">{{ result.type }}</div>
                    </div>
                </div>
            </div>

            <!-- Hard Failure State - No Results -->
            <div *ngIf="!loadingState.isLoading() && searchResults.length === 0" class="no-results">
                <div class="no-results-icon">üîç</div>
                <p>{{ COPY.HARD_FAILURE.NO_ROUTE_YET }}</p>
                <p class="no-results-hint">{{ COPY.REASSURANCE.WORKING_ON_IT }}</p>
            </div>
        </div>

        <!-- Find Route Button -->
        <button class="btn btn-primary btn-xl find-route-btn" (click)="findRoute()"
            [disabled]="!fromLocation || !toLocation">
            üöÄ Find My Route
        </button>

        <!-- Divider -->
        <div class="divider">
            <span class="divider-text">OR</span>
        </div>

        <!-- Popular Routes -->
        <div class="popular-routes-section">
            <h3 class="section-title">üî• Popular Routes</h3>
            <div class="popular-routes-list">
                <div class="popular-route-card" *ngFor="let route of popularRoutes" (click)="selectPopularRoute(route)">
                    <div class="route-emoji">{{ route.emoji }}</div>
                    <div class="route-details">
                        <div class="route-path">
                            <span class="route-from">{{ route.from }}</span>
                            <span class="route-arrow">‚Üí</span>
                            <span class="route-to">{{ route.to }}</span>
                        </div>
                    </div>
                    <div class="route-action">‚Ä∫</div>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="quick-actions">
            <button class="quick-action-btn" routerLink="/contribute">
                <span class="action-icon">üìç</span>
                <span class="action-text">Add Landmark</span>
            </button>
            <button class="quick-action-btn" routerLink="/favorites">
                <span class="action-icon">‚≠ê</span>
                <span class="action-text">Favorites</span>
            </button>
            <button class="quick-action-btn" routerLink="/history">
                <span class="action-icon">üïê</span>
                <span class="action-text">History</span>
            </button>
        </div>
    </div>

    <!-- Footer Info -->
    <div class="footer-info">
        <p class="info-text">
            üí° <strong>Tip:</strong> Search using local names like "Berger", "Yellow House", or "After Shoprite"
        </p>
    </div>
</div>

<!-- Refine Location Modal -->
<app-refine-location-modal [isOpen]="isRefineModalOpen" [currentName]="refineModalCurrentName"
    (closed)="onRefineModalClosed($event)">
</app-refine-location-modal>