<div class="auth-container">
    <!-- Animated Background -->
    <div class="background-scene">
        <div class="animated-gradient"></div>

        <svg class="route-lines" viewBox="0 0 1200 800" preserveAspectRatio="none">
            <defs>
                <linearGradient id="lineGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                    <stop offset="0%" stop-color="rgba(0,127,246,0)" />
                    <stop offset="50%" stop-color="rgba(0,127,246,0.6)" />
                    <stop offset="100%" stop-color="rgba(0,127,246,0)" />
                </linearGradient>
                <filter id="glow">
                    <feGaussianBlur stdDeviation="4" result="coloredBlur" />
                    <feMerge>
                        <feMergeNode in="coloredBlur" />
                        <feMergeNode in="SourceGraphic" />
                    </feMerge>
                </filter>
            </defs>

            <path class="route-path route-1" d="M 0 200 Q 300 100 600 200 T 1200 200" stroke="url(#lineGradient)"
                stroke-width="3" fill="none" filter="url(#glow)" />
            <path class="route-path route-2" d="M 0 400 Q 400 300 800 400 T 1200 400" stroke="url(#lineGradient)"
                stroke-width="3" fill="none" filter="url(#glow)" />
        </svg>

        <div class="glass-orb orb-1"></div>
        <div class="glass-orb orb-2"></div>
    </div>

    <!-- Main Content -->
    <div class="auth-content centered">
        <!-- Reset Password Card -->
        <div class="login-card reset-card">
            <div class="card-shimmer"></div>

            <!-- Icon -->
            <div class="card-icon" *ngIf="!passwordReset">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="5" y="11" width="14" height="10" rx="2" />
                    <path d="M7 11V7a5 5 0 0 1 10 0v4" />
                </svg>
            </div>

            <!-- Success Icon -->
            <div class="card-icon success" *ngIf="passwordReset">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
                    <polyline points="22 4 12 14.01 9 11.01" />
                </svg>
            </div>

            <!-- Header -->
            <div class="card-header centered">
                <h1 class="card-title" *ngIf="!passwordReset">Set New Password</h1>
                <h1 class="card-title" *ngIf="passwordReset">Password Reset!</h1>
                <p class="card-subtitle" *ngIf="!passwordReset">
                    Your new password must be different from previously used passwords
                </p>
                <p class="card-subtitle" *ngIf="passwordReset">
                    Your password has been successfully reset.<br>
                    Redirecting to sign in...
                </p>
            </div>

            <!-- Form (Show only if password not reset) -->
            <form class="auth-form" (ngSubmit)="onSubmit()" *ngIf="!passwordReset">
                <!-- New Password -->
                <div class="form-field">
                    <div class="field-wrapper" [class.has-value]="password" [class.is-focused]="passwordFocused">
                        <label for="password" class="field-label">New Password</label>
                        <div class="field-container">
                            <span class="field-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="5" y="11" width="14" height="10" rx="2" />
                                    <path d="M7 11V7a5 5 0 0 1 10 0v4" />
                                </svg>
                            </span>
                            <input [type]="showPassword ? 'text' : 'password'" id="password" class="field-input"
                                [(ngModel)]="password" name="password" (ngModelChange)="onPasswordChange()"
                                (focus)="passwordFocused = true" (blur)="passwordFocused = false"
                                autocomplete="new-password" required />
                            <button type="button" class="field-action" (click)="togglePasswordVisibility('password')">
                                <svg *ngIf="!showPassword" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" />
                                    <circle cx="12" cy="12" r="3" />
                                </svg>
                                <svg *ngIf="showPassword" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path
                                        d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24" />
                                    <line x1="1" y1="1" x2="23" y2="23" />
                                </svg>
                            </button>
                        </div>
                    </div>

                    <!-- Password Strength Indicator -->
                    <div class="password-strength" *ngIf="password">
                        <div class="strength-bar">
                            <div class="strength-fill" [style.width.%]="passwordStrength"
                                [style.background-color]="getPasswordStrengthColor()"></div>
                        </div>
                        <span class="strength-label" [style.color]="getPasswordStrengthColor()">
                            {{ getPasswordStrengthLabel() }}
                        </span>
                    </div>

                    <!-- Password Requirements -->
                    <div class="password-requirements" *ngIf="password">
                        <div class="requirement" [class.met]="passwordRequirements.minLength">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="20 6 9 17 4 12" />
                            </svg>
                            <span>At least 8 characters</span>
                        </div>
                        <div class="requirement" [class.met]="passwordRequirements.hasUpperCase">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="20 6 9 17 4 12" />
                            </svg>
                            <span>One uppercase letter</span>
                        </div>
                        <div class="requirement" [class.met]="passwordRequirements.hasLowerCase">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="20 6 9 17 4 12" />
                            </svg>
                            <span>One lowercase letter</span>
                        </div>
                        <div class="requirement" [class.met]="passwordRequirements.hasNumber">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="20 6 9 17 4 12" />
                            </svg>
                            <span>One number</span>
                        </div>
                        <div class="requirement" [class.met]="passwordRequirements.hasSpecialChar">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="20 6 9 17 4 12" />
                            </svg>
                            <span>One special character</span>
                        </div>
                    </div>
                </div>

                <!-- Confirm Password -->
                <div class="form-field">
                    <div class="field-wrapper" [class.has-value]="confirmPassword"
                        [class.is-focused]="confirmPasswordFocused">
                        <label for="confirmPassword" class="field-label">Confirm Password</label>
                        <div class="field-container" [class.error]="confirmPassword && password !== confirmPassword">
                            <span class="field-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="5" y="11" width="14" height="10" rx="2" />
                                    <path d="M7 11V7a5 5 0 0 1 10 0v4" />
                                </svg>
                            </span>
                            <input [type]="showConfirmPassword ? 'text' : 'password'" id="confirmPassword"
                                class="field-input" [(ngModel)]="confirmPassword" name="confirmPassword"
                                (focus)="confirmPasswordFocused = true" (blur)="confirmPasswordFocused = false"
                                autocomplete="new-password" required />
                            <button type="button" class="field-action" (click)="togglePasswordVisibility('confirm')">
                                <svg *ngIf="!showConfirmPassword" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" />
                                    <circle cx="12" cy="12" r="3" />
                                </svg>
                                <svg *ngIf="showConfirmPassword" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path
                                        d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24" />
                                    <line x1="1" y1="1" x2="23" y2="23" />
                                </svg>
                            </button>
                        </div>
                        <p class="field-error" *ngIf="confirmPassword && password !== confirmPassword">
                            Passwords do not match
                        </p>
                    </div>
                </div>

                <!-- Submit Button -->
                <button type="submit" class="btn-primary" [disabled]="isResetting || !isFormValid()"
                    [class.is-loading]="isResetting">
                    <span class="btn-content" *ngIf="!isResetting">
                        <span>Reset Password</span>
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                            <path d="M5 12h14M12 5l7 7-7 7" />
                        </svg>
                    </span>
                    <span class="btn-loader" *ngIf="isResetting">
                        <svg class="spinner" viewBox="0 0 50 50">
                            <circle cx="25" cy="25" r="20" fill="none" stroke="currentColor" stroke-width="4" />
                        </svg>
                        <span>Resetting...</span>
                    </span>
                </button>
            </form>

            <!-- Back to Login -->
            <div class="card-footer" *ngIf="!passwordReset">
                <button type="button" class="back-button" (click)="goToLogin()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 12H5M12 19l-7-7 7-7" />
                    </svg>
                    <span>Back to Sign In</span>
                </button>
            </div>
        </div>
    </div>
</div>