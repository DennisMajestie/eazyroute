<div class="notification-overlay" [class.open]="isOpen" (click)="onClose()"></div>

<div class="notification-panel" [class.open]="isOpen">
    <div class="panel-header">
        <div class="header-main">
            <h3>Notifications</h3>
            @if ((unreadCount$ | async); as count) {
            <span class="unread-badge">{{ count }} New</span>
            }
        </div>
        <div class="header-actions">
            <button class="btn-text" (click)="markAllAsRead()">Mark all as read</button>
            <button class="btn-icon" (click)="onClose()">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18" />
                    <line x1="6" y1="6" x2="18" y2="18" />
                </svg>
            </button>
        </div>
    </div>

    <div class="panel-content">
        @if ((notifications$ | async); as notifications) {
        @if (notifications.length > 0) {
        <div class="notification-list">
            @for (notification of notifications; track notification._id || notification.id) {
            <div class="notification-item" [class.unread]="!notification.isRead"
                (click)="markAsRead(notification._id || notification.id)">
                <div class="item-icon" [ngClass]="getTypeClass(notification.type)">
                    @if (notification.type === 'milestone') {
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2">
                        <path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z" />
                        <circle cx="12" cy="10" r="3" />
                    </svg>
                    } @else if (notification.type === 'reroute') {
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2">
                        <polyline points="23 4 23 10 17 10" />
                        <polyline points="1 20 1 14 7 14" />
                        <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15" />
                    </svg>
                    } @else if (notification.type === 'trip_completed') {
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2">
                        <polyline points="20 6 9 17 4 12" />
                    </svg>
                    } @else {
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2">
                        <path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9" />
                        <path d="M10.3 21a1.94 1.94 0 0 0 3.4 0" />
                    </svg>
                    }
                </div>
                <div class="item-body">
                    <div class="item-header">
                        <span class="item-title">{{ notification.title }}</span>
                        <span class="item-time">{{ formatDate(notification.timestamp) }}</span>
                    </div>
                    <p class="item-message">{{ notification.message }}</p>
                </div>
                <button class="item-delete" (click)="deleteNotification(notification._id || notification.id, $event)">
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2">
                        <path
                            d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
                    </svg>
                </button>
            </div>
            }
        </div>
        } @else {
        <div class="empty-state">
            <div class="empty-icon">ðŸ””</div>
            <h4>Clear environment!</h4>
            <p>No new notifications at the moment. Your trips are smooth!</p>
        </div>
        }
        }
    </div>
</div>